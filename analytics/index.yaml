#TODO: OpenAPI v2 doesn't allow JSON items serialization. There may be a way to represent it in v3 (https://github.com/OAI/OpenAPI-Specification/issues/437), but Redoc isn't ready for it yet. Using items definition also allows specifying item definition (type and description). If we want to have cleaner documentation it may be worth it to consider if any of supported serializers could be added as new suggested format or if we can push for inclusion of JSON serializer into standard (https://github.com/OAI/OpenAPI-Specification/blob/master/versions/2.0.md#fixed-fields-7 serialization options are described in "collectionFormat").
swagger: '2.0'
info:
  title: Tracking API
  description: |
    <p><b>No authentication.</b></p>
  #TODO: What's correct version of API? It probably shouldn't be synced with PPMS version.
  version: '1.0.0'
host: ppms.example.com
basePath: /
schemes:
  - https
consumes:
  - application/x-www-form-urlencoded
produces:
  - image/gif
paths:
  /piwik.php:
    get:
      summary:
        Tracking endpoint.
      description: |
        <p>Endpoint tracking actions (page views, events and visits).</p>
      parameters:
        - name: idsite
          in: formData
          #TODO: Make sure we're already using new name.
          description: Application ID (previously Website ID).
          required: true
          type: string
          format: UUID
          minLength: 32
          maxLength: 32
          example: 892d04bd-6e2b-4914-bfb4-bac721b37235
        - name: rec
          in: formData
          description: Consent to tracking (value "1" allows it).
          required: true
          type: integer
          #TODO: Confirm that those are only options.
          minimum: 0
          maximum: 1
          example: 1
        - name: action_name
          in: formData
          #TODO: Link to more info about categories
          #TODO: Check if recommended parameters are still most important
          description: |
            <p><strong>Recommended</strong> Name of action.</p>
            <p>It's possible to categorize actions by preceding it with one or more category names separated by slash
            character ("/").</p>
          type: string
          example: help/delivery/shipping
        - name: url
          in: formData
          description: <strong>Recommended</strong> URL of action.
          type: string
          #TODO: Check what is maximal allowed length
          format: URL
          example: http://example.com/path/to/page.html
        - name: _id
          in: formData
          #TODO: Link to default Visitor identification strategy.
          description: |
            <p><strong>Recommended</strong> Visitor ID.</p>
            <p>It allows to use external application identifier of a Visitor instead of default identifier generated by
            the analytics.</p>
          type: string
          format: hexadecimal
          #TODO: Check if length has to always be 16
          minLength: 16
          maxLength: 16
          example: 257cc22df0ec483a
        - name: rand
          in: formData
          #TODO: Make sure it's still recommended. I think old IE had to use cache buster because it ignored response headers.
          description: |
            <p><strong>Recommended</strong> Cache buster.</p>
            <p>It's value should be unique for every request to make sure that request is send to server instead of
            read from cache. Value can be random or sequential (e.g. UNIX timestamp).</p>
          example: 1521232150
        - name: apiv
          in: formData
          description: |
            <p><strong>Recommended</strong> API (major) version number used by request.</p>
          type: integer
          enum:
            - 1
          example: 1
        - name: urlref
          in: formData
          #TODO: Check what spelling we're using: referrer vs referer.
          description: |
            <p>HTTP referer.</p>
            <p>URL of previous page that linked to current one.</p>
          type: string
          #TODO: Check what is maximal allowed length
          format: URL
          example: http://example.com/path/to/previous/page.html
        - name: _cvar
          in: formData
          #TODO: I don't understand this parameter or it's format. HALP!
          #TODO: Confirm serialization format (it's supposed to be Array JSON, but example suggests Array-like Object JSON).
          #TODO: Confirm description of item format.
          #TODO: Add limits of item values (e.g. max length).
          #TODO: Link to a page describing custom variables.
          description: |
            <p>Custom variables list set on the visit scope.</p>
            <p>Each item on the list is a list of 2 elements. First is variable name (string) and second is it's value
            (string).</p>
          type: string
          #TODO: See JSON comment.
          format: JSON
          #TODO: Look for better example of custom variable.
          example: {"1":["AspectRatio","16:9"],"2":["Height","1080"],"3":["Width","1920"]}
        - name: cvar
          in: formData
          #TODO: I don't understand this parameter or it's format. HALP!
          #TODO: Confirm serialization format (it's supposed to be Array JSON, but example suggests Array-like Object JSON).
          #TODO: Confirm description of item format.
          #TODO: Add limits of item values (e.g. max length).
          #TODO: Link to a page describing custom variables.
          description: |
            <p>Custom variables list set on the page scope.</p>
            <p>Each item on the list is a list of 2 elements. First is variable name (string) and second is it's value
            (string).</p>
          type: string
          #TODO: See JSON comment.
          format: JSON
          #TODO: Look for better example of custom variable.
          example: {"1":["AspectRatio","16:9"],"2":["Height","1080"],"3":["Width","1920"]}
        - name: _idvc
          in: formData
          #TODO: Is the mentioned report correct?
          #TODO: Should we link to definition of a visit?
          description: |
            <p>Visit counter.</p>
            <p>It sets visit number of the Visitor. It requires that external application tracks how many times Visitor
            already used it.</p>
            <p>Used in <em>Visitors</em> > <em>Engagement</em> > <em>Visits by visit number</em> report.</p>
          type: integer
          example: 42
        - name: _viewts
          in: formData
          #TODO: Is the mentioned report correct?
          description: |
            <p>Time of previous visit.</p>
            <p>Used in <em>Visitors</em> > <em>Engagement</em> > <em>Visits by days since last visit</em> report.</p>
          type: integer
          format: UNIX timestamp
          #TODO: Confirm that it doesn't include milliseconds.
          example: 1521232150
        - name: _idts
          in: formData
          #TODO: Is the mentioned report correct?
          description: |
            <p>Time of first visit.</p>
            <p>Used in <em>Goals</em> > <em>Days to Conversion</em> report.</p>
          type: integer
          format: UNIX timestamp
          example: 1521232150
        - name: _rcn
          in: formData
          #TODO: Can any action start new visit or do this has to be a page view?
          description: |
            <p>Reference campaign name.</p>
            <p>Used to attribute visit to marketing campaign and can be set only on first action of a visit.</p>
            <p>Used in <em>Referrers</em> > <em>Campaigns</em> report.</p>
          type: string
          example: Email-2018-03
        - name: _rck
          in: formData
          description: |
            <p>Reference campaign keywords.</p>
            <p>Used to set keywords of marketing campaign and can be set only on first action of a visit.</p>
            <p>Used in <em>Referrers</em> > <em>Campaigns</em> report.
          type: string
          #TODO: Is it possible to set multiple keywords to the campaign?
          example: promotion
        - name: res
          in: formData
          #TODO: Confirm used unit (pixels).
          description: Resolution of Visitors device in pixels.
          type: string
          format: '{height}x{width}'
          example: 1920x1080
        - name: h
          in: formData
          description: Hour when the request was made in Visitors local time.
          type: integer
          minimum: 0
          maximum: 23
          example: 16
        - name: m
          in: formData
          description: Minute when the request was made in Visitors local time.
          type: integer
          minimum: 0
          maximum: 59
          example: 44
        - name: s
          in: formData
          description: Second when the request was made in Visitors local time.
          type: integer
          minimum: 0
          maximum: 59
          example: 12
        - name: ua
          in: formData
          description: |
            <p><em>User-Agent</em> value.</p>
            <p>This value can be used to override value send in request HTTP header.</p>
            <p>It's used to detect Visitors browser and operating system.</p>
          type: string
          example: |
            Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.162 Safari/537.36
        - name: lang
          in: formData
          #TODO: Do we support any instances without GeoIP? Is there any other reason to gather this data?
          description: |
            <p><em>Accept-Language</em> value.</p>
            <p>This value can be used to override value send in request HTTP header.</p>
            <p>It's used to guess Visitors country when GeoIP is disabled.</p>
          type: string
          example: en-US,en;q=0.9,pl;q=0.8
        - name: uid
          in: formData
          #TODO: Check if Piwik passes this information to AM.
          #TODO: Looks like this functionality is trying to implement basic user profile. Should it be depricated in favor of AM?
          #TODO: Previous documentation is unclear and dispersed. We should link to a page describing how uid id used in detail.
          description: |
            <p>User ID.</p>
            <p>Can be used to identify Visitor by external application (e.g. login name, email address or internal
            user ID).</p>
            <p>It allows merging visits accross different devices (e.g. laptop, tablet and smartphone).</p>
          type: string
          minLength: 1
          example: PhilipFry
        - name: cid
          in: formData
          #TODO: What's the difference between _uid, cid and uid parameters? Are some of those deprecated?
          description: |
            <p>Visitor ID.</p>
            <p>It allows to use external application identifier of a Visitor instead of default identifier generated by
            the analytics.</p>
          type: string
          format: hexadecimal
          minLength: 16
          maxLength: 16
          #TODO: Check if hexadecimal string is case sensitive.
          example: 257cc22df0ec483a
        - name: new_visit
          in: formData
          description: Force start of new visit when value is "1".
          type: integer
          #TODO: Check if 0 is valid option.
          minimal: 0
          maximal: 1
          example: 1
        #TODO: I don't think it's possible to represent patterned name in OpenAPI. Names should be dimension1, dimension2, ..., dimension999. What now?
        - name: dimension[0-9]{1,3}
          in: formData
          #TODO: Check if we're always installing custom dimensions plugin.
          #TODO: Link to custom dimension guide.
          description: |
            <p>Custom dimmension value.</p>
            <p>May be used to assign arbitrary value to the Visitor or action.</p>
          type: string
          example: blue
        - name: link
          in: formData
          #TODO: Should we recommend setting url parameter to same value?
          description: External URL opened by the Visitor.
          type: string
          format: URL
          example: http://help-example.com/how-to/register.html
        - name: download
          in: formData
          #TODO: Should we recommend setting url parameter to same value?
          description: URL of downloaded file.
          type: string
          format: URL
          example: http://example.com/files/TermsOfService.pdf
        - name: search
          in: formData
          #TODO: Does it replace default page view tracking with specialized search tracking?
          description: |
            <p>Internal search query.</p>
            <p>Used to track what Visitor searched in application.</p>
          type: string
          example: sherlock holmes
        - name: search_cat
          in: formData
          description: |
            <p>Internal search category.</p>
            <p>Used to track if Visitor specified cateroty while searching in application.</p>
          type: string
          example: Movies & TV
        - name: search_count
          in: formData
          description: |
            <p>Number of results of internal search.</p>
            <p>Used to track number of results found by the Visitor.</p>
          type: integer
          example: 2218
        - name: pv_id
          in: formData
          #TODO: I'm guessing this parameter. Halp!
          description: |
            <p>Unique page view ID generated when page is loaded.</p>
            <p>It's used to attach following actions to specific page view.</p>
          type: string
          format: hexadecimal
          minimum: 6
          maximum: 6
          example: ff5c6d
        - name: idgoal
          in: formData
          description: |
            <p>Goal ID.</p>
            <p>Signifies that a goal has been reached and tracks it's conversion.</p>
            <p>Value "0" is reserved for Ecommerce (cart or order) tracking.</p>
          #TODO: Confirm format of a goal ID.
          type: integer
          example: 15
        - name: revenue
          in: formData
          #TODO: Confirm revenue format. Is it in cents?
          description: |
            <p>Revenue value of accieved goal.</p>
            <p>Currency of the value doesn't matter, but only one should be used by the application (e.g. USD).</p>
            <p>It's recommended to use lowest nominal available in selected currency (e.g. 4.99 USD tracked as 499 US
            cents).</p>
          type: integer
          example: 499
        - name: ec_id
          in: formData
          description: Ecommerce order ID.
          #TODO: Confirm type is correct.
          type: integer
          example: 3352
        - name: ec_items
          in: formData
          #TODO: Confirm format in example is valid.
          #TODO: Confirm that all attributes of item are required.
          #TODO: Add limits to the item attributes (e.g. string max length).
          description: |
            <p>Ecommerce order item list.</p>
            <p>Each item on the list must contain "sku" - string (stock keeping unit), "name" - string,
            "category" - string, "price" - integer and "quantity" - integer.</p>
            <p>Currency of the price value doesn't matter, but only one should be used by the application (e.g. USD).</p>
            <p>It's recommended to use lowest nominal available in selected currency (e.g. 4.99 USD tracked as 499 US
            cents).</p>
          type: string
          #TODO: See JSON comment.
          format: JSON
          example:
            - sku: "craft-311"
              name: "Unicorn Iron on Patch"
              category: "Crafts & Sewing"
              price: 499
              quantity: 3
            - sku: "craft-312"
              name: "Unicorn Lamp"
              category: "Crafts & Sewing"
              price: 1325
              quantity: 1
        - name: ec_st
          in: formData
          description: |
            <p>Ecommerce order sub total (order cost without shipping).</p>
            <p>Currency of the value doesn't matter, but only one should be used by the application (e.g. USD).</p>
            <p>It's recommended to use lowest nominal available in selected currency (e.g. 4.99 USD tracked as 499 US
            cents).</p>
          type: integer
          example: 499
        - name: ec_tx
          in: formData
          description: |
            <p>Ecommerce order tax.</p>
            <p>Currency of the value doesn't matter, but only one should be used by the application (e.g. USD).</p>
            <p>It's recommended to use lowest nominal available in selected currency (e.g. 4.99 USD tracked as 499 US
            cents).</p>
          type: integer
          example: 499
        - name: ec_sh
          in: formData
          description: |
            <p>Ecommerce order shipping.</p>
            <p>Currency of the value doesn't matter, but only one should be used by the application (e.g. USD).</p>
            <p>It's recommended to use lowest nominal available in selected currency (e.g. 4.99 USD tracked as 499 US
            cents).</p>
          type: integer
          example: 499
        - name: ec_dt
          in: formData
          description: |
            <p>Ecommerce order discount.</p>
            <p>Currency of the value doesn't matter, but only one should be used by the application (e.g. USD).</p>
            <p>It's recommended to use lowest nominal available in selected currency (e.g. 4.99 USD tracked as 499 US
            cents).</p>
          type: integer
          example: 499
        - name: _ects
          in: formData
          description: |
            <p>Time of last Ecommerce order.</p>
            <p>Used in <em>Days since last order</em> report.</p>
          type: integer
          format: Unix timestamp
          example: 1521232150
        - name: gt_ms
          in: formData
          #TODO: Previously it was specified as generation time with mention that JavaScript tracker includes in it also loading time. Can we simplify this to always recommend that interpretation?
          description: |
            <p>Page generation and load time in milliseconds.</p>
            <p>Used for example in <em>Page speed</em> report.</p>
          type: integer
          example: 264
        - name: cs
          in: formData
          description: |
            <p>Page charset.</p>
            <p>Used to decode text data send in request.</p>
          type: string
          default: UTF-8
          example: ISO-8859-1
        #TODO: Add parameters before plugin section.
        - name: cookie
          in: formData
          description: Status of Cookie capability in Visitor browser (value "1" indicates that it's enabled).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: fla
          in: formData
          description: Status of Flash plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: java
          in: formData
          description: Status of Java plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: dir
          in: formData
          #TODO: Confirm name of plugin.
          description: Status of Adobe Director plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: qt
          in: formData
          description: Status of QuickTime plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: realp
          in: formData
          description: Status of RealPlayer plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: pdf
          in: formData
          #TODO: Confirm name of plugin.
          description: Status of PDF plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: wma
          in: formData
          #TODO: Confirm name of plugin.
          description: |
            Status of Windows Media Player plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: gears
          in: formData
          #TODO: Confirm name of plugin.
          description: Status of (Google) Gears plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        - name: ag
          in: formData
          description: Status of Silverlight plugin in Visitor browser (value "1" indicates that it's installed).
          type: integer
          minimum: 0
          maximum: 1
          example: 1
        #TODO: Link to custom event description.
        - name: e_c
          in: formData
          description: Custom event category.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: graph
        - name: e_a
          in: formData
          description: Custom event action.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: range
        - name: e_n
          in: formData
          description: Custom event name.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: finantial-report
        - name: e_v
          in: formData
          description: Custom event value.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: 201704-201711
        #TODO: Link to content tracking description.
        - name: c_n
          in: formData
          description: Content name.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: recommended-products
        - name: c_p
          in: formData
          description: Content piece.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: Unicorn Iron on Patch
        - name: c_t
          in: formData
          description: Content target.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: http://example.com/product/unicorn-iron-on-path.html
        - name: c_i
          in: formData
          description: Content interaction.
          type: string
          minLength: 1
          #TODO: Specify maximal allowed length.
          example: show details
        #TODO: Decide if media analytics should be described in separate document and link to it if yes.
        - name: send_image
          in: formData
          description: |
            <p>Request response content.</p>
            <p>"0" - HTTP 204 [No content].<br>"1" - HTTP 200 [1 pixel GIF].</p>
          type: integer
          minimum: 0
          maximum: 1
          default: 1
          example: 0
        - name: bots
          in: formData
          description: |
            <p>Bots tracking.</p>
            <p>"0" - disabled.<br>"1" - enabled.</p>
          type: integer
          minimum: 0
          maximum: 1
          default: 0
          example: 0
        - name: token_auth
          in: formData
          description: |
            <p>Authentication token.</p>
            <p>Override parameters are usually used for debugging. They should be used only by authorized personel
            (SuperUser or Admin) and requires "token_auth".</p>
          type: string
          minLength: 32
          maxLength: 32
          example: caa18074df8347b684d7b943b2484fe9
        - name: cip
          in: formData
          description: |
            <p>Override IP.</p>
            <p>Override parameters are usually used for debugging. They should be used only by authorized personel
            (SuperUser or Admin) and requires "token_auth".</p>
          type: string
          format: IPv4|IPv6
          example: 172.16.254.1
        - name: cdt
          in: formData
          #TODO: Is it possible to set time in the future? What will happen then?
          #TODO: Confirm that all requests using this parameter require reports re-processing (even those in last 24h).
          #TODO: Link to page describing how to force re-processing of a report.
          description: |
            <p>Override request time.</p>
            <p>If this parameter is used it's necessary to re-process report for time range containing set time.
            Otherwise new request won't be included in the report.</p>
            <p>It's possible to override request time without authentication if difference between set time and current
            one is less then or equal 24h. Setting time older then that follows standard authentication rules for debug
            parameters.</p>
            <p>Override parameters are usually used for debugging. They should be used only by authorized personel
            (SuperUser or Admin) and requires "token_auth".</p>
          type: string
          format: UNIX timestamp|UTC DateTime<YYYY-MM-DD hh:mm:ss>
          example: '2018-02-24 15:34:48'
        - name: country
          in: formData
          description: |
            <p>Override country.</p>
            <p>Override parameters are usually used for debugging. They should be used only by authorized personel
            (SuperUser or Admin) and requires "token_auth".</p>
          type: string
          #TODO: Confirm that this format is correct.
          format: ISO 3166-1 alpha-2 code (lowercase)
          example: us
        - name: region
          in: formData
          description: |
            <p>Override region.</p>
            <p>Format of <a href="https://www.maxmind.com/download/geoip/misc/region_codes.csv">region codes</a> is
            defined in <a href="https://www.maxmind.com/">MaxMind's</a> GeoIP database.</p>
            <p>Override parameters are usually used for debugging. They should be used only by authorized personel
            (SuperUser or Admin) and requires "token_auth".</p>
          type: string
          #TODO: Check if Maxmind uses codes defined in any standard.
          #TODO: Check if those codes are still accurate (migration to GeoIPv2).
          #TODO: Check if codes should be uppercase.
          format: 2 letter region code
          example: AE
        - name: city
          in: formData
          description: |
            <p>Override city.</p>
            <p>Override parameters are usually used for debugging. They should be used only by authorized personel
            (SuperUser or Admin) and requires "token_auth".</p>
          type: string
          example: New York
        - name: lat
          in: formData
          description: |
            <p>Override latitude.</p>
            <p>Override parameters are usually used for debugging. They should be used only by authorized personel
            (SuperUser or Admin) and requires "token_auth".</p>
          type: number
          #TODO: Check if there's a limit to the number of decimal places.
          format: Decimal degrees
          #TODO: Check if it's possible to set minimum below zero.
          minimium: -90
          maximum: 90
          example: 40.7629659
        - name: lon
          in: formData
          description: |
            <p>Override longitude.</p>
            <p>Override parameters are usually used for debugging. They should be used only by authorized personel
            (SuperUser or Admin) and requires "token_auth".</p>
          type: number
          format: Decimal degrees
          minimium: -180
          maximum: 180
          example: -74.0023705
      responses:
        200:
          description: OK
        204:
          description: No content
        400:
          description: Bad Request
    post:
      summary:
        Tracking endpoint.
      #TODO: Confirm if mentioning GET parameters in description is enough or do we need to repeat all of them here.
      description: |
        <p>Endpoint tracking actions (page views, events and visits).</p>
        <p>In addition to standard tracking parameters from GET request it's able to handle bulk requests.</p>
      consumes:
        - application/json
      parameters:
        - in: body
          required: true
          schema:
            type: object
            required:
              - token_auth
              - requests
            properties:
              token_auth:
                description: |
                  <p>Authentication token.</p>
                  <p>Bulk processing of requests is specialized functionality. It should be used only by authorized
                  personel (SuperUser or Admin) and requires "token_auth".</p>
                type: string
                minLength: 32
                maxLength: 32
                example: caa18074df8347b684d7b943b2484fe9
              requests:
                type: array
                description: List of requests to track.
                items:
                  type: string
                example:
                  - "?idsite=892d04bd-6e2b-4914-bfb4-bac721b37235&url=http%3A%2F%2Fexample.com%2F&action_name=pageview&rec=1"
                  - "?idsite=892d04bd-6e2b-4914-bfb4-bac721b37235&url=http%3A%2F%2Fexample.com%2Fsub%2Fpage.html&action_name=pageview&rec=1"
      responses:
        200:
          description: OK
        204:
          description: No content
        400:
          description: Bad Request
